# Render.com Deployment Guide

## Single Server Deployment (Frontend + Backend)

This application is configured to run both frontend and backend on a single Render.com instance.

### Prerequisites
- GitHub repository with the code
- Render.com account
- Environment variables configured

### Deployment Steps

1. **Push code to GitHub**
   ```bash
   git init
   git add .
   git commit -m "Initial commit"
   git remote add origin <your-repo-url>
   git push -u origin main
   ```

2. **Create New Web Service on Render.com**
   - Go to Render Dashboard
   - Click "New +" → "Web Service"
   - Connect your GitHub repository
   - Select the repository

3. **Configure Service**
   - **Name**: luna-ai (or your preferred name)
   - **Environment**: Python
   - **Build Command**: 
     ```
     pip install -r backend/requirements.txt && cd frontend && npm install && npm run build
     ```
   - **Start Command**: 
     ```
     cd backend && uvicorn app.main:app --host 0.0.0.0 --port $PORT
     ```

4. **Environment Variables**
   Add these in Render dashboard:
   - `PYTHON_VERSION`: 3.11.0
   - `OPENROUTER_API_KEY`: your-openrouter-key
   - `GOOGLE_API_KEY`: your-google-api-key
   - `DATABASE_URL`: (auto-generated by Render if using PostgreSQL)

5. **Deploy**
   - Click "Create Web Service"
   - Render will automatically build and deploy

### How It Works

1. **Build Process**:
   - Installs Python dependencies
   - Installs Node.js dependencies
   - Builds React frontend to `frontend/dist`

2. **Runtime**:
   - FastAPI serves on port specified by Render ($PORT)
   - FastAPI serves static files from `frontend/dist`
   - API routes available at `/api/*`
   - Frontend served at root `/`

3. **Routing**:
   - `/api/chat/*` → Backend API
   - `/health` → Health check
   - `/*` → Frontend SPA (React)

### Local Testing

Test the production build locally:

```bash
# Build frontend
cd frontend
npm run build

# Run backend (serves frontend)
cd ../backend
uvicorn app.main:app --host 0.0.0.0 --port 8000
```

Visit: http://localhost:8000

### Troubleshooting

**Build fails**: Check Python version and Node.js version in logs
**API not working**: Verify environment variables are set
**Frontend not loading**: Check that `frontend/dist` exists after build
**Database errors**: Ensure database is created and migrations run

### Alternative: Using render.yaml

The included `render.yaml` can be used for automatic deployment:

1. Push code with `render.yaml` to GitHub
2. In Render dashboard, click "New +" → "Blueprint"
3. Connect repository
4. Render will auto-configure from `render.yaml`

### Cost
- Free tier available (with limitations)
- Paid plans start at $7/month for better performance
